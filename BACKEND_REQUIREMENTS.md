# Backend Requirements - GymHelper VK Mini App

## Краткое описание

Требуется разработать REST API для VK Mini App "TrainSync" - приложения для управления тренировками и упражнениями.

## Основные сущности

### 1. User (Пользователь)
- VK ID, имя, фото, уровень (beginner/amateur/advanced/expert)
- Любимый спортзал, статистика тренировок

### 2. Exercise (Упражнение)  
- Название, описание, группы мышц, оборудование
- Пошаговая инструкция, рекомендации, медиа файлы
- Время отдыха, диапазон весов

### 3. Workout (Тренировка)
- Название, дата, время, описание, спортзал
- Список упражнений с подходами
- Участники, статус выполнения

### 4. Set (Подход)
- Количество повторений, вес, время, дистанция

## Ключевые endpoint'ы

### Аутентификация
```
POST /api/v1/auth/vk-login - авторизация через VK
```

### Пользователи
```
GET /api/v1/users/me - профиль пользователя
PUT /api/v1/users/me - обновление профиля
GET /api/v1/users/friends - список друзей
```

### Упражнения
```
GET /api/v1/exercises - список с фильтрацией и поиском
POST /api/v1/exercises - создание
PUT /api/v1/exercises/:id - обновление
DELETE /api/v1/exercises/:id - удаление
POST /api/v1/exercises/:id/media - загрузка медиа
```

### Тренировки
```
GET /api/v1/workouts - список с фильтрацией
POST /api/v1/workouts - создание
PUT /api/v1/workouts/:id - обновление
DELETE /api/v1/workouts/:id - удаление
POST /api/v1/workouts/:id/complete - завершение
```

### Дополнительно
```
GET /api/v1/calendar - календарь тренировок
GET /api/v1/statistics/me - статистика пользователя
```

## Особенности реализации

### Аутентификация
- JWT токены на основе VK User ID
- Заголовок: `Authorization: Bearer <token>`

### Пагинация
- Query параметры: `page`, `limit` (по умолчанию 20)
- Ответ: `{ data: [], total: number, page: number, limit: number }`

### Фильтрация и поиск
- Упражнения: по группам мышц, оборудованию, поиск по названию
- Тренировки: по дате, статусу, спортзалу

### Загрузка файлов
- Поддержка изображений (JPEG, PNG, WebP, до 5MB)
- Поддержка видео (MP4, WebM, до 50MB)
- Возврат URL для доступа к файлам

### Валидация
- Обязательные поля для всех сущностей
- Валидация дат, времени, весов
- Ограничения на размеры файлов

### Права доступа
- Пользователи могут редактировать только свои упражнения
- Создатель тренировки может управлять участниками
- Публичные упражнения доступны всем

## База данных

### Основные таблицы
```sql
users - пользователи
exercises - упражнения  
exercise_steps - шаги выполнения
exercise_recommendations - рекомендации
workouts - тренировки
workout_exercises - упражнения в тренировке
sets - подходы
workout_participants - участники тренировки
```

### Связи
- User 1:N Exercise (создатель)
- User 1:N Workout (создатель)
- Workout N:M User (участники)
- Workout 1:N WorkoutExercise
- WorkoutExercise 1:N Set
- Exercise 1:N ExerciseStep
- Exercise 1:N ExerciseRecommendation

## Технические требования

### Производительность
- Индексы на часто используемые поля (user_id, date, muscle_group)
- Кэширование списков упражнений
- Оптимизация запросов с JOIN'ами

### Безопасность
- Валидация всех входящих данных
- Санитизация файлов при загрузке
- Rate limiting для API
- CORS настройки для VK домена

### Мониторинг
- Логирование всех API запросов
- Метрики использования
- Обработка ошибок с читаемыми сообщениями

## Форматы данных

### Даты
- ISO 8601 для API (2024-01-15T10:30:00Z)
- YYYY-MM-DD для дат без времени
- HH:mm для времени

### Ответы API
```json
{
  "data": { /* основные данные */ },
  "message": "optional success message"
}
```

### Ошибки
```json
{
  "error": "Error Type",
  "message": "Human readable message",
  "details": [
    {
      "field": "field_name", 
      "message": "field error"
    }
  ]
}
```

## Приоритеты разработки

### MVP (обязательно)
1. Аутентификация пользователей
2. CRUD операции для упражнений
3. CRUD операции для тренировок
4. Базовая статистика

### Дополнительно
1. Загрузка медиа файлов
2. Приглашения в тренировки
3. Календарь тренировок
4. Расширенная статистика

## Тестирование

### Unit тесты
- Валидация данных
- Бизнес-логика
- Права доступа

### Integration тесты  
- API endpoints
- База данных
- Загрузка файлов

### Данные для тестирования
- Тестовые пользователи VK
- Набор упражнений для разных групп мышц
- Примеры тренировок

---

**Контакты:** При вопросах по требованиям или API контрактам обращайтесь к frontend разработчику.
